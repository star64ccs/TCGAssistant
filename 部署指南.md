# TCG助手後端部署指南

## 🌐 雲端部署選項

### 1. 免費選項

#### A. Render.com (推薦)
```bash
# 優點：
- 免費層級每月750小時
- 自動部署
- 支持Node.js
- 簡單易用

# 部署步驟：
1. 註冊 Render.com
2. 連接 GitHub 倉庫
3. 選擇 Node.js 環境
4. 設置環境變數
5. 自動部署
```

#### B. Railway.app
```bash
# 優點：
- 免費層級每月500小時
- 快速部署
- 支持多種數據庫

# 部署步驟：
1. 註冊 Railway
2. 導入 GitHub 項目
3. 自動檢測 Node.js
4. 設置環境變數
```

#### C. Heroku (有限免費)
```bash
# 優點：
- 穩定可靠
- 豐富的插件生態
- 良好的文檔

# 注意：
- 免費層級已停止
- 需要信用卡驗證
```

### 2. 付費選項

#### A. DigitalOcean
```bash
# 優點：
- 每月$5起
- 完全控制
- 高性能
- 99.99% 可用性

# 適合：
- 生產環境
- 需要自定義配置
- 預算充足
```

#### B. AWS EC2
```bash
# 優點：
- 高度可擴展
- 豐富的服務生態
- 企業級支持

# 適合：
- 大型項目
- 需要複雜架構
- 有AWS經驗
```

## 🔧 部署準備

### 1. 修改後端配置

#### 更新 CORS 設置
```javascript
// backend/simple-test-server.js
app.use((req, res, next) => {
  // 允許所有來源（開發環境）
  res.header('Access-Control-Allow-Origin', '*');
  // 或指定特定域名
  // res.header('Access-Control-Allow-Origin', 'https://your-frontend-domain.com');
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');
  if (req.method === 'OPTIONS') {
    res.sendStatus(200);
  } else {
    next();
  }
});
```

#### 添加環境變數支持
```javascript
// backend/simple-test-server.js
const PORT = process.env.PORT || 3000;
const NODE_ENV = process.env.NODE_ENV || 'development';

// 根據環境調整CORS
const allowedOrigins = NODE_ENV === 'production' 
  ? ['https://your-frontend-domain.com'] 
  : ['*'];
```

### 2. 創建部署配置文件

#### package.json 腳本
```json
{
  "scripts": {
    "start": "node simple-test-server.js",
    "dev": "nodemon simple-test-server.js",
    "build": "echo 'No build step required'"
  },
  "engines": {
    "node": ">=16.0.0"
  }
}
```

#### Procfile (Heroku)
```
web: npm start
```

## 🚀 Render.com 部署步驟

### 步驟1：準備代碼
```bash
# 確保後端代碼在 GitHub 上
git add .
git commit -m "準備部署到Render"
git push origin main
```

### 步驟2：在Render上創建服務
1. 訪問 https://render.com
2. 註冊/登錄帳戶
3. 點擊 "New +" → "Web Service"
4. 連接 GitHub 倉庫
5. 選擇後端目錄

### 步驟3：配置服務
```bash
# 服務名稱
Name: tcg-assistant-backend

# 環境
Environment: Node

# 構建命令
Build Command: npm install

# 啟動命令
Start Command: npm start

# 根目錄
Root Directory: backend
```

### 步驟4：設置環境變數
```bash
NODE_ENV=production
PORT=10000
API_VERSION=v1
CORS_ORIGIN=*
```

### 步驟5：部署
- 點擊 "Create Web Service"
- 等待自動部署完成
- 獲取服務URL（例如：https://tcg-assistant-backend.onrender.com）

## 🔄 更新前端配置

### 1. 更新API基礎URL
```javascript
// src/config/unifiedConfig.js 或相關配置文件
const API_BASE_URL = process.env.NODE_ENV === 'production'
  ? 'https://your-backend-url.onrender.com'
  : 'http://localhost:3000';
```

### 2. 更新環境變數
```bash
# .env
REACT_APP_API_URL=https://your-backend-url.onrender.com
REACT_APP_FEATURE_REAL_API=true
```

## 📱 測試部署

### 1. 測試後端端點
```bash
# 健康檢查
curl https://your-backend-url.onrender.com/health

# API端點
curl https://your-backend-url.onrender.com/api/v1

# 用戶資料
curl https://your-backend-url.onrender.com/api/v1/user/profile
```

### 2. 更新前端測試組件
```javascript
// src/examples/FrontendBackendConnectionTest.js
const API_BASE_URL = 'https://your-backend-url.onrender.com';

// 更新所有fetch調用
const response = await fetch(`${API_BASE_URL}/health`);
```

## 🔍 常見問題解決

### 問題1：CORS錯誤
```javascript
// 確保後端CORS配置正確
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  // ... 其他CORS設置
});
```

### 問題2：環境變數未設置
```bash
# 在Render控制台檢查環境變數
# 確保所有必要的變數都已設置
```

### 問題3：端口問題
```javascript
// 使用環境變數的PORT
const PORT = process.env.PORT || 3000;
```

## 📊 監控和維護

### 1. 日誌監控
- Render提供實時日誌
- 設置日誌警報
- 監控錯誤率

### 2. 性能監控
- 監控響應時間
- 設置性能警報
- 優化數據庫查詢

### 3. 備份策略
- 定期備份數據
- 設置自動備份
- 測試恢復流程

## 💰 成本估算

### 免費層級
- Render: 免費（每月750小時）
- Railway: 免費（每月500小時）
- Vercel: 免費（個人項目）

### 付費選項
- DigitalOcean: $5/月
- AWS EC2: $3-10/月
- Heroku: $7/月

## 🎯 推薦方案

### 開發階段
1. **Render.com** - 免費、簡單、可靠
2. **Railway.app** - 快速部署、良好體驗

### 生產環境
1. **DigitalOcean** - 性價比高、完全控制
2. **AWS** - 企業級、高度可擴展

---

**立即開始部署，享受無縫的前後端連接體驗！** 🚀
